<?xml version="1.0" encoding="UTF-8"?>
<!-- 마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.epozen.epozenMall.dao.ProductMapper">
	
	<!-- 상품 목록페이지 상품 카운트 -->
	<select id="selectCntAll" resultType="int">
		SELECT COUNT(*)
		FROM shop_product
	</select>
	<!-- 상품 목록 페이지 -->
	<select id="selectAll"  parameterType="com.epozen.epozenMall.util.Paging" resultType="com.epozen.epozenMall.vo.ShopProductVO">
<!-- 		SELECT pro_no proNo, pro_cate proCate, pro_name proName, pro_price proPrice, pro_detail proDetail, img_no imgNo -->
<!-- 		FROM SHOP_PRODUCT -->
<!-- 		ORDER BY pro_no desc -->
			SELECT * FROM
				(SELECT rownum rnum, B.*
				    FROM (
				        SELECT pro_no proNo, pro_cate proCate, pro_name proName, pro_price proPrice, pro_detail proDetail, img_no imgNo
				        FROM SHOP_PRODUCT
				        ORDER BY pro_no desc
				        ) B
				)
			WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>
	
	<!-- 상품 상세 페이지 -->
	<select id="selectProDetail" parameterType="int" resultType="com.epozen.epozenMall.vo.ShopProductVO">
		SELECT 
			pro_no proNo,
			pro_cate proCate,
			pro_name proName,
			pro_price proPrice,
			pro_detail proDetail,
			img_no imgNo
		 FROM
			SHOP_PRODUCT 
		WHERE 
			pro_no = #{proNo}		
	</select>
	
	<!-- 상품평 갯수 -->
	<select id="selectProcomCnt" resultType="int">
		SELECT COUNT(*)
		FROM SHOP_PROCOM
	</select>
	
	<!-- 상품평 -->
	<select id="selectProCom" resultType="com.epozen.epozenMall.vo.ShopProcomVO">
		SELECT 
			A.procom_no procomNO,
			B.user_Id userId,
			C.pro_no proNO,
			A.procom_contents procomContents,
			A.procom_regdate procomRegdate
		FROM
			SHOP_PROCOM  A, SHOP_USER  B, SHOP_PRODUCT C
		WHERE
			A.user_id = B.user_id
		AND 
			A.pro_no = C.pro_no
		AND 
			A.pro_no = #{proNo}
		
	</select>
	
	<!-- 장바구니 담기 -->
	<insert id="insertInCart" parameterType="com.epozen.epozenMall.vo.ShopCartVO">
		INSERT INTO SHOP_CART(
			cart_no cartNo,
			user_id userId,
			pro_no proNo,
			cart_amount cartAmount,
			cart_Price cartPrice
		)
		VALUES (
			seq_cartNo.nextval,
			#{userId},
			#{proNo},
			#{cartAmount},
			#{cartPrice}
		)
	</insert>
	
	<!-- <update id="updateCart">
		UPDATE 
	
	</update>
	<select id="countCart">

	
	</select> -->
	
	<insert id="insertOrder" parameterType="com.epozen.epozenMall.vo.ShopUserVO">
		INSERT INTO SHOP_ORDER (
			order_no orderNo,
			user_id userId,
			order_date orderDate,
			order_state orderState,
			order_price orderPrice
		)	
		VALUES (
			#{orderNo},
			#{userId},
			TO_DATE(SYSDATE,'yyyy/MM/dd'),
			#{orderState},
			#{orderPrice}
		)
	</insert>

</mapper>